---
title: TIL015 - XRT 실행 모델과 특징2
excerpt: "XRT의 커널 실행 모델 컨트롤"
categories: TIL
tags: xilinx
toc: true
toc_sticky: true
---

## 1. Intro

- XRT는 커널 실행 모델의 디테일을 숨겨서 유저는 커널의 인터페이스를 호스트 코드에 명시할 일 없이 OpenCL이나 XRT API를 사용해서 커널을 실행할 것이다.
- HLS 플로우에서 커널 코드의 pragma는 XRT 지원 모델과 공명해서 HLS가 RTL을 생성하게 한다.
- RTL 커널의 경우 유저가 커널 생성의 유연성을 지니고 있다. 해당 사항에서 이점을 얻으려면 XRT 지원 실행 모델을 이해하는 것이 바람직하다.
- 로우 레벨에서 커널은 AXI-4 Lite Slave interface의 0x0번 주소와 매칭되는 control과 status 레지스터로 컨트롤 된다.

## 2. 순차 실행 모델

- 레거시 모델이며 AP_CTRL_HS pragma로 생성 가능하다.

![image-20220313235725791](https://raw.githubusercontent.com/chun1000/2022-image-repo/image/image-20220313235725791.png)

1. XRT 드라이버가 ap_start에 1을 써서 커널이 시작한다.
2. XRT 드라이버가 ap_done이 커널에서 올 떄까지 기다린다. 이렇게 해서 출력 데이터가 완전히 커널에서 생성 완료된지 여부를 알 수 있다.
3. 1-2를 반복한다.

## 3. Pipelined Execution Model

- 디폴트 모델이며, AP_CTRL_CHAIN pragma를 통해서 실행 가능하다.
- 다수의 커널 실행이 겹쳐서 돌아갈 수 있으나, 출력은 순서대로이다.

![image-20220314011757849](https://raw.githubusercontent.com/chun1000/2022-image-repo/image/image-20220314011757849.png)

- Input Sync
  1. XRT 드라이버가 커널 시작을 위해 1을 쓴다.
  2. XRT는 ap_ready를 통해서 커널이 새로운 실행을 할 수 있는 것을 알 수 있다.
  3. XRT 드라이버는 ap_start를 다시 쓴다.
- Output Sync
  1. XRT 드라이버는 ap_done으로 커널 출력 데이터가 생성됐다는걸 기다린다.
  2. XRT 드라이버는 커널이 계속 돌도록 ap_continue를 쓴다.

## 4. User-managed와 Un-managed

- User-managed, 다른 임의의 실행 모델들은 XRT API에 의해 명시적으로 관리되어야한다. xrt::ip가 이러한 커널의 컨트롤, 쓰기, 읽기를 지원한다.
- Un-managed
  - 커널은 컨트롤 인터페이스 없이 구현 될 수 있다. 
  - 인터페이스의 데이터 가용성에 따라서 작동해서 호스트 코드가 컨트롤 하는 것이 불가능하다.
  - 커널은 오직 스트림을 통해서만 소통하고 처리할 데이터가 없으면 정지하고 새로운 데이터가 오기를 기다린다. 
  - 커널은 AXI4-Lite Slave 인터페이스를 통한 스칼라 입력/출력을 지닐 것이다. 
  - 커널은 xrt::ip::read_register / write_register를 통해서 읽고 쓰기가 가능하다.

